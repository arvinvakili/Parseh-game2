<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø§Ù…Ù¾Ø±Ø§Ø·ÙˆØ±ÛŒ Ù¾Ø§Ø±Ø³Ù‡</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <style>
        /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒÙ‡ */
        :root { --bg: #050505; --gold: #ffc107; --panel: rgba(20,20,20,0.95); }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        
        body {
            background: #000 url('images/bg.png') center/cover no-repeat fixed;
            color: #fff; font-family: 'Tahoma', serif; margin: 0; height: 100vh;
            display: flex; flex-direction: column; overflow: hidden;
        }

        /* --- Ù‡Ø¯Ø± --- */
        header {
            height: 110px; background: linear-gradient(180deg, rgba(0,0,0,1), transparent);
            padding: 10px 20px; display: flex; flex-direction: column; justify-content: center; z-index: 10;
        }
        .top-bar { display: flex; justify-content: space-between; align-items: center; width: 100%; margin-bottom: 5px; }
        
        /* Ú©Ù¾Ø³ÙˆÙ„ Ù…Ù†Ø§Ø¨Ø¹ (Ø¨Ø²Ø±Ú¯) */
        .res-pill {
            background: rgba(50,50,50,0.8); border: 1px solid var(--gold); border-radius: 12px;
            padding: 5px 15px; display: flex; align-items: center; min-width: 90px; position: relative;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }
        .res-icon { 
            width: 45px; height: 45px; position: absolute; right: -15px; bottom: -5px; 
            filter: drop-shadow(0 5px 5px rgba(0,0,0,0.5)); z-index: 2;
        }
        .res-val { margin-right: 25px; font-weight: bold; font-size: 1.2rem; }
        .fallback-txt { font-size: 1.5rem; position: absolute; right: -5px; bottom: 0; }

        .rank-title { color: var(--gold); font-weight: bold; font-size: 1.2rem; text-shadow: 0 0 10px var(--gold); }

        /* Ù†ÙˆØ§Ø± XP */
        .xp-box { width: 100%; height: 8px; background: #222; border-radius: 4px; overflow: hidden; border: 1px solid #444; }
        .xp-fill { height: 100%; background: linear-gradient(90deg, #00acc1, #00e5ff); width: 0%; transition: width 0.3s; }

        /* --- Ú©Ø§Ù†ØªÛŒÙ†Ø± Ø§ØµÙ„ÛŒ --- */
        #game-area { flex: 1; position: relative; width: 100%; overflow: hidden; }
        
        .tab-content {
            position: absolute; inset: 0; display: none; flex-direction: column; 
            align-items: center; padding: 20px; overflow-y: auto; padding-bottom: 100px;
        }
        .tab-content.active { display: flex; }

        /* Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ */
        .card {
            background: var(--panel); border: 2px solid #3e2723; border-radius: 20px;
            padding: 20px; width: 100%; max-width: 360px; text-align: center;
            box-shadow: 0 10px 40px #000; margin-bottom: 20px;
        }
        .card h2 { color: var(--gold); margin: 0 0 20px 0; font-size: 1.5rem; }
        
        .img-box {
            width: 150px; height: 150px; margin: 0 auto 15px auto;
            background: radial-gradient(circle, rgba(255,215,0,0.1), transparent 70%);
            display: flex; justify-content: center; align-items: center; border-radius: 50%;
        }
        .main-img { width: 100%; height: 100%; object-fit: contain; transform: scale(1.2); }

        /* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ (Ø¶Ù…Ø§Ù†Øª Ø¹Ù…Ù„Ú©Ø±Ø¯) */
        .btn {
            width: 100%; padding: 20px; margin-top: 10px;
            background: #3e2723; color: var(--gold); border: 2px solid #5d4037;
            border-radius: 12px; font-size: 1.3rem; font-weight: bold; cursor: pointer;
            box-shadow: 0 6px 0 #1b0000; position: relative; z-index: 100; /* Ø§ÙˆÙ„ÙˆÛŒØª Ú©Ù„ÛŒÚ© Ø¨Ø§Ù„Ø§ */
        }
        .btn:active { transform: translateY(4px); box-shadow: 0 2px 0 #1b0000; }
        .btn:disabled { background: #333; color: #666; border-color: #444; box-shadow: none; transform: none; }
        
        .btn-green { background: #1b5e20; border-color: #2e7d32; color: #fff; box-shadow: 0 6px 0 #003300; }
        .btn-blue { background: #004d40; border-color: #00695c; color: #e0f2f1; box-shadow: 0 6px 0 #00251a; }

        /* ØªØ§ÛŒÙ…Ø± Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ */
        .overlay {
            position: absolute; inset: 0; background: rgba(0,0,0,0.85); border-radius: 10px;
            display: none; align-items: center; justify-content: center; color: var(--gold); font-size: 1.5rem;
        }
        .btn.loading .overlay { display: flex; }

        /* Ù†ÙˆØ§Ø± Ù¾Ø§ÛŒÛŒÙ† */
        nav {
            height: 80px; background: #111; display: grid; grid-template-columns: repeat(4, 1fr);
            border-top: 2px solid #333; z-index: 50;
        }
        .nav-btn {
            background: none; border: none; color: #666; font-size: 0.8rem; font-weight: bold;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .nav-btn.active { color: var(--gold); background: rgba(255,215,0,0.1); border-top: 3px solid var(--gold); }
        .nav-icon { font-size: 1.8rem; margin-bottom: 5px; }

        /* Ù…ÙˆØ¯Ø§Ù„ Ø´Ø±ÙˆØ¹ */
        #start-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.98); z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .welcome-box {
            border: 2px solid var(--gold); padding: 30px; border-radius: 20px; background: #1a1a1a;
            text-align: center; width: 80%; max-width: 350px;
        }

        /* Ù¾ÛŒØ§Ù… */
        #msg-box {
            position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%);
            background: #222; border: 1px solid var(--gold); color: var(--gold);
            padding: 10px 20px; border-radius: 10px; display: none; z-index: 10000; white-space: nowrap;
        }
        
        .prog-bar { width: 100%; height: 10px; background: #000; margin-bottom: 10px; border-radius: 5px; overflow: hidden; }
        .prog-fill { height: 100%; background: orange; width: 100%; }
        
        #error-debug { display: none; position: fixed; top: 0; left: 0; width: 100%; background: red; color: white; z-index: 20000; font-size: 10px; }
    </style>
</head>
<body>

<div id="error-debug"></div>

<div id="start-overlay">
    <div class="welcome-box">
        <h1 style="color:var(--gold); font-size: 2rem;">Ø´Ú©ÙˆÙ‡Ù Ù¾Ø§Ø±Ø³Ù‡</h1>
        <p style="color:#ccc; margin: 20px 0;">ÙØ±Ù…Ø§Ù†Ø±ÙˆØ§ÛŒ Ú¯Ø±Ø§Ù…ÛŒØŒ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯.</p>
        <button class="btn" style="background:var(--gold); color:#000;" onclick="window.gameStart()">Ø¢ØºØ§Ø²</button>
    </div>
</div>

<header>
    <div class="top-bar">
        <div class="res-pill">
            <span id="txt-bread" class="res-val">0</span>
            <img src="images/bread.png" class="res-icon" onerror="this.style.display='none'; this.nextElementSibling.style.display='block'">
            <div class="fallback-txt" style="display:none;">ğŸ</div>
        </div>
        <div class="rank-title" id="txt-rank">Ø¨Ø±Ø²ÛŒÚ¯Ø±</div>
        <div class="res-pill">
            <span id="txt-coin" class="res-val">0</span>
            <img src="images/daric.png" class="res-icon" onerror="this.style.display='none'; this.nextElementSibling.style.display='block'">
            <div class="fallback-txt" style="display:none;">ğŸ’°</div>
        </div>
    </div>
    
    <div style="display:flex; justify-content:center; margin-top:5px;">
        <span style="font-size:0.9rem;">Ø´ÛŒØ±: <span id="txt-milk" style="color:var(--gold)">0</span> Ù¾ÛŒØ§Ù„Ù‡</span>
    </div>

    <div style="font-size:0.7rem; color:#aaa; margin-top:5px;">Ù¾ÛŒØ´Ø±ÙØª: <span id="txt-xp">0%</span></div>
    <div class="xp-box"><div class="xp-fill" id="bar-xp"></div></div>
</header>

<div id="game-area">
    <div id="tab-1" class="tab-content active">
        <div class="card">
            <h2>Ú©Ø´ØªØ²Ø§Ø±</h2>
            <div class="img-box">
                <img src="images/shovel.png" class="main-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='block'">
                <div style="font-size:4rem; display:none;">â›ï¸</div>
            </div>
            <div style="display:flex; justify-content:space-between; color:#aaa; font-size:0.8rem;">
                <span>ØªÙˆØ§Ù†</span> <span id="txt-dur">3/3</span>
            </div>
            <div class="prog-bar"><div class="prog-fill" id="bar-dur"></div></div>
            
            <button id="btn-farm" class="btn" onclick="window.actFarm()">
                Ú©Ø´Øª (Û³Ûµ Ø¯Ù‚ÛŒÙ‚Ù‡)
                <div class="overlay" id="tm-farm">00:00</div>
            </button>
