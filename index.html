<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù…Ù¾Ø±Ø§Ø·ÙˆØ±ÛŒ Ù¾Ø§Ø±Ø³Ù‡</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: #050505;
            --gold: #ffc107;
            --panel: rgba(30,30,30,0.98);
        }
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
        }
        body {
            background: #000 url('images/bg.png') center/cover no-repeat fixed;
            color: #fff;
            font-family: Tahoma, sans-serif;
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        #start-modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.98);
            z-index: 10000;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .modal-box {
            border: 2px solid var(--gold);
            padding: 30px;
            border-radius: 20px;
            background: #111;
            text-align: center;
            width: 85%;
            max-width: 350px;
        }
        .start-btn {
            background: var(--gold);
            color: #000;
            border: none;
            padding: 15px 30px;
            font-size: 1.3rem;
            border-radius: 40px;
            margin-top: 15px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 0 20px var(--gold);
        }
        header {
            height: 130px;
            background: linear-gradient(180deg, rgba(0,0,0,0.95), transparent);
            padding: 10px 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            z-index: 10;
        }
        .row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .pill {
            background: rgba(60,60,60,0.8);
            border: 1px solid #555;
            border-radius: 12px;
            padding: 5px 15px;
            display: flex;
            gap: 10px;
            align-items: center;
            min-width: 90px;
        }
        .pill img {
            width: 30px;
            height: 30px;
        }
        .pill span {
            font-weight: bold;
            font-size: 1.1rem;
        }
        .rank-title {
            color: var(--gold);
            text-shadow: 0 0 5px var(--gold);
            font-size: 1.2rem;
        }
        .xp-con {
            margin-top: 5px;
            width: 100%;
        }
        .xp-bg {
            height: 8px;
            background: #333;
            border-radius: 4px;
        }
        .xp-fill {
            height: 8px;
            background: linear-gradient(90deg, #00b09b, #96c93d);
            transition: width 0.3s;
            border-radius: 4px;
        }
        #game-area {
            flex: 1;
            overflow-y: auto;
            position: relative;
        }
        .tab-view {
            display: none;
            padding: 15px;
        }
        .tab-view.active-tab {
            display: block;
        }
        .card {
            background: var(--panel);
            border: 2px solid #3e2723;
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 10px 20px #000;
            margin-bottom: 20px;
        }
        .img-box {
            width: 200px;
            height: 200px;
            margin: auto;
        }
        .card-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        .btn {
            width: 100%;
            padding: 15px;
            border-radius: 12px;
            border: none;
            margin-top: 10px;
            font-size: 1rem;
            cursor: pointer;
            font-weight: bold;
        }
        .btn-act { background: #3e2723; color: var(--gold); }
        .btn-glean { background: #004d40; color: #fff; }
        .btn-buy { background: #1b5e20; color: #fff; }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .timer { display: none; }
        .loading .timer { display: block; }
        nav {
            height: 90px;
            background: #0a0a0a;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            border-top: 2px solid #333;
        }
        .nav-btn {
            background: none;
            border: none;
            color: #aaa;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        .nav-btn.active {
            color: var(--gold);
            border-top: 3px solid var(--gold);
        }
        #toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: #222;
            color: var(--gold);
            border: 1px solid var(--gold);
            border-radius: 8px;
            padding: 10px 15px;
            display: none;
            z-index: 100000;
        }
    </style>
</head>
<body>
    <div id="start-modal">
        <div class="modal-box">
            <h1 style="color:var(--gold);font-size:2rem;margin-bottom:10px;">Ø§Ù…Ù¾Ø±Ø§Ø·ÙˆØ±ÛŒ Ù¾Ø§Ø±Ø³Ù‡</h1>
            <p style="color:#bbb;">Ø¨Ù‡ Ø¯Ø§Ø³ØªØ§Ù† Ø§Ù…Ù¾Ø±Ø§Ø·ÙˆØ±ÛŒ Ø¨Ù¾ÛŒÙˆÙ†Ø¯ÛŒØ¯...<br>ØªØ§Ø±ÛŒØ® Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ø´Ù…Ø§Ø³Øª.</p>
            <button id="btn-enter" class="start-btn">ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø¯Ø§Ø³ØªØ§Ù†</button>
        </div>
    </div>

    <header>
        <div class="row">
            <div class="pill"><span>ğŸ</span><span id="v-bread">0</span></div>
            <div class="rank-title" id="v-rank">Ø¨Ø±Ø²ÛŒÚ¯Ø±</div>
            <div class="pill"><span id="v-coin">0</span><span>ğŸ’°</span></div>
        </div>
        <div style="text-align:center;font-size:0.8rem;color:#aaa;">Ø´ÛŒØ±: <span id="v-milk">0</span> | Ù¾ÛŒØ´Ø±ÙØª: <span id="v-xp">0%</span></div>
        <div class="xp-con"><div class="xp-bg"><div class="xp-fill" id="bar-xp" style="width:0%;"></div></div></div>
    </header>

    <div id="game-area">
        <div id="view-farm" class="tab-view active-tab">
            <div class="card">
                <h2>Ú©Ø´ØªØ²Ø§Ø±Ù‡Ø§ÛŒ Ù¾Ø§Ø±Ø³</h2>
                <div style="margin: 10px auto;">ØªÙˆØ§Ù†: <span id="v-dur">3/3</span></div>
                <button id="btn-farm" class="btn btn-act">Ú©Ø´Øª (Û³Ûµ Ø¯Ù‚ÛŒÙ‚Ù‡)<div class="timer" id="t-farm"></div></button>
                <button id="btn-glean" class="btn btn-glean">Ø®ÙˆØ´Ù‡â€ŒÚ†ÛŒÙ†ÛŒ (Ø³Ø±ÛŒØ¹)<div class="timer" id="t-glean"></div></button>
            </div>
        </div>

        <div id="view-smith" class="tab-view">
            <div class="card">
                <h2>Ø¢Ù‡Ù†Ú¯Ø±Ø³Ø±Ø§</h2>
                <p style="color:#aaa;">Ø¨Ø§Ø²Ø³Ø§Ø²ÛŒ Ø§Ø¨Ø²Ø§Ø±</p>
                <button id="btn-rep" class="btn btn-act">Ø¨Ø§Ø²Ø³Ø§Ø²ÛŒ (Û±Ûµ Ø¯Ù‚ÛŒÙ‚Ù‡)<div class="timer" id="t-rep"></div></button>
            </div>
        </div>

        <div id="view-herd" class="tab-view">
            <div id="herd-box" style="width:100%"></div>
        </div>
        
        <div id="view-tribe" class="tab-view">
            <div class="card"><h2>Ø®Ø§Ù†Ø¯Ø§Ù†â€ŒÙ‡Ø§</h2><p>Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ...</p></div>
        </div>
    </div>

    <nav>
        <button id="nav-1" class="nav-btn active">ğŸŒ¾<br>Ú©Ø´Øª</button>
        <button id="nav-2" class="nav-btn">ğŸ”¨<br>Ø¢Ù‡Ù†Ú¯Ø±ÛŒ</button>
        <button id="nav-3" class="nav-btn">ğŸ<br>Ú¯Ù„Ù‡</button>
        <button id="nav-4" class="nav-btn">ğŸ›¡ï¸<br>Ø®Ø§Ù†Ø¯Ø§Ù†</button>
    </nav>

    <div id="toast"></div>

    <script>
    const SAVE_KEY = 'PARSEH_V5';
    const CFG = {
        T_M: 60,
        farm: 35*60,
        glean: 3,
        rep: 15*60,
        maxDur: 3,
        animals: [
            {id:'cow', n:'Ú¯Ø§Ùˆ Ø´ÛŒØ±Ø¯Ù‡', c:55, f:5, t:20*60, out:3, icon:'ğŸ„', lvl:2},
            {id:'sheep', n:'Ú¯ÙˆØ³ÙÙ†Ø¯', c:35, f:2, t:25*60, out:2, icon:'ğŸ‘', lvl:3},
            {id:'goat', n:'Ø¨Ø² Ú©ÙˆÙ‡ÛŒ', c:20, f:3, t:35*60, out:1, icon:'ğŸ', lvl:5}
        ],
        ranks:["Ø¨Ø±Ø²ÛŒÚ¯Ø±","Ø¯ÙÙ‡Ø¨Ø§Ù†","Ø³Ø±Ø¨Ø§Ø²","Ø³Ø±Ø¯Ø³ØªÙ‡","ÙØ±Ù…Ø§Ù†Ø¯Ù‡","Ø³Ø§ØªØ±Ø§Ù¾","ÙˆØ²ÛŒØ±","Ø´Ø§Ù‡Ù†Ø´Ø§Ù‡"],
        levels:[100,200,330,440,555,710,1000,99999]
    };
    let G = {bread:0,coins:0,milk:0,dur:3,lvl:1,xp:0,end:{farm:0,glean:0,rep:0},animals:{},seen:false};

    function el(i){return document.getElementById(i);}
    function now(){return Math.floor(Date.now()/1000);}
    function fmt(s){if(s<0)s=0;let m=Math.floor(s/60),sec=s%60;return m+":"+(sec<10?"0":"")+sec;}
    function msg(t){const e=el("toast");e.textContent=t;e.style.display="block";setTimeout(()=>e.style.display="none",2500);}
    function save(){localStorage.setItem(SAVE_KEY,JSON.stringify(G));}
    function load(){let d=localStorage.getItem(SAVE_KEY);if(d){try{G=Object.assign(G,JSON.parse(d));}catch(e){}}}

    function render(){
        el("v-bread").innerText=G.bread;
        el("v-coin").innerText=G.coins;
        el("v-milk").innerText=Math.floor(G.milk);
        el("v-rank").innerText=CFG.ranks[G.lvl-1];
        el("v-dur").innerText=G.dur+"/3";
        let req=CFG.levels[G.lvl-1],pct=Math.min(100,Math.floor(G.xp/req*100));
        el("v-xp").textContent=pct+"%"; el("bar-xp").style.width=pct+"%";
    }

    function switchTab(n){
        document.querySelectorAll('.tab-view').forEach(x=>x.classList.remove('active-tab'));
        document.querySelectorAll('.nav-btn').forEach(x=>x.classList.remove('active'));
        el("view-"+n).classList.add('active-tab');
        if(n==="herd") renderHerd();
        const map={farm:"nav-1",smith:"nav-2",herd:"nav-3",tribe:"nav-4"};
        el(map[n]).classList.add('active');
    }

    function renderHerd(){
        let h="";
        CFG.animals.forEach(a=>{
            let has=G.animals[a.id], busy=G.end[a.id]>0, lock=G.lvl<a.lvl;
            h+=`<div class="card"><h3>${a.n}</h3>`;
            if(lock) h+=`<div style="color:#ff6666">Ù‚ÙÙ„ (Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø±ØªØ¨Ù‡ ${CFG.ranks[a.lvl-1]})</div>`;
            else if(!has) h+=`<button class="btn btn-buy" onclick="buy('${a.id}')">Ø®Ø±ÛŒØ¯ (${a.c} Ø¯Ø±ÛŒÚ©)</button>`;
            else if(busy) h+=`<button class="btn btn-act loading" disabled><div id="tm-${a.id}" class="timer">...</div></button>`;
            else h+=`<button class="btn btn-act" onclick="milk('${a.id}')">Ø¯ÙˆØ´ÛŒØ¯Ù† (${a.f} Ù†Ø§Ù†)</button>`;
            h+=`</div>`;
        });
        el("herd-box").innerHTML=h;
    }

    function actFarm(){if(G.dur<=0)return msg("Ø§Ø¨Ø²Ø§Ø± Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªØ¹Ù…ÛŒØ± Ø¯Ø§Ø±Ø¯");G.end.farm=now()+CFG.farm;save();}
    function actGlean(){G.end.glean=now()+CFG.glean;save();}
    function actRep(){G.end.rep=now()+CFG.rep;save();}

    function buy(id){let a=CFG.animals.find(x=>x.id===id);if(G.coins<a.c)return msg("Ø¯Ø±ÛŒÚ© Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª");G.coins-=a.c;G.animals[id]=true;save();renderHerd();render();}
    function milk(id){let a=CFG.animals.find(x=>x.id===id);if(G.bread<a.f)return msg("Ù†Ø§Ù† Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª");G.bread-=a.f;G.end[id]=now()+a.t;save();renderHerd();}

    function addXP(n){G.xp+=n;let r=CFG.levels[G.lvl-1];if(G.xp>=r&&G.lvl<8){G.xp-=r;G.lvl++;msg("Ø§Ø±ØªÙ‚Ø§ Ø±ØªØ¨Ù‡!");}render();save();}

    function finFarm(){G.end.farm=0;G.bread+=2;G.dur--;addXP(5);msg("+Û² Ù†Ø§Ù†");save();}
    function finGlean(){G.end.glean=0;G.bread++;addXP(1);msg("+Û± Ù†Ø§Ù† Ø³Ø±ÛŒØ¹!");save();}
    function finRep(){G.end.rep=0;G.dur=3;msg("Ø§Ø¨Ø²Ø§Ø± Ø¨Ø§Ø²Ø³Ø§Ø²ÛŒ Ø´Ø¯");save();}
    function finMilk(id){let a=CFG.animals.find(x=>x.id===id);G.end[id]=0;G.milk+=a.out;msg("Ø´ÛŒØ± Ø¯ÙˆØ´ÛŒØ¯Ù‡ Ø´Ø¯");renderHerd();save();render();}

    function loop(){
        const n=now();
        if(G.end.farm && n>=G.end.farm) finFarm();
        if(G.end.glean && n>=G.end.glean) finGlean();
        if(G.end.rep && n>=G.end.rep) finRep();
        CFG.animals.forEach(a=>{
            if(G.end[a.id] && n>=G.end[a.id]) finMilk(a.id)
            else if(G.end[a.id]){let e=el("tm-"+a.id);if(e)e.innerText=fmt(G.end[a.id]-n);}
        });
        render();
    }

    window.addEventListener("DOMContentLoaded",()=>{
        load();render();
        if(G.seen) el("start-modal").style.display="none";
        el("btn-enter").onclick=()=>{G.seen=true;save();el("start-modal").style.display="none";msg("Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!")};
        el("btn-farm").onclick=actFarm;
        el("btn-glean").onclick=actGlean;
        el("btn-rep").onclick=actRep;
        el("nav-1").onclick=()=>switchTab("farm");
        el("nav-2").onclick=()=>switchTab("smith");
        el("nav-3").onclick=()=>switchTab("herd");
        el("nav-4").onclick=()=>switchTab("tribe");
        setInterval(loop,1000);
    });
    </script>
</body>
</html>
